## 一、使用说明

inDB.dist整个文件夹，入口文件为inDB.exe

### 入库示例

```python
cd "D:\code\satellite-analysis\inDB\inDB.dist"

inDB.exe --db_config "D:\code\satellite-analysis\inDB\json\dbConfig.json" --product_config "D:\code\satellite-analysis\inDB\json\productLC08Config.json" "D:\code\satellite-analysis\inDB\json\productLC09Config.json" --output_log "D:\code\satellite-analysis\inDB\json\log.txt" --scenes_dir "E:\Data\0708"
```

### 参数说明

#### --db_config

dbConfig.json绝对路径，一般无需变化，存在北京内网机器共享磁盘中

#### --scenes_dir

待入库景列表文件夹的绝对路径，例如 `J49`

#### --product_config

productConfig.json，后面跟`N`个路径就入`N`个产品，例如：

```python
--product_config "产品1的json路径" "产品2的json路径" "以此类推..."
```

productConfig.json标准如下：

```python
{
	"IS_SINGLE": True,
    "SCENE_PREFIX": "GF1",
    "IS_SINGLE": false, // 默认为true
    "TEMP_OUTPUT_DIR": "Z:\\NNU_OpenGMS\\temp",
    "CUR_SENSOR_NAME": "GF-1_PMS",
    "CUR_PRODUCT_NAME": "GF-1_ARD",
    "CUR_RESOLUTION": "2m",
    "CUR_PERIOD": "16d",
    "TAGS": {
        "source": "national",
        "production": "light",
        "category": "ard"
    }
}
```

##### IS_SINGLE

可选键值对，没有默认为True，即默认单波段入库
##### SCENE_PREFIX

待入库景文件夹名字开头的统一前缀，以此区分产品
##### TEMP_OUTPUT_DIR

一般无需修改，保证入库机器节点可访问相应磁盘，且磁盘空间大小足够大即可
##### CUR_SENSOR_NAME

==CUR_SENSOR_NAME== 采用以下表格中已有的 `sensor_name` 一列，在此假设入库高分一号数据，故设`CUR_SENSOR_NAME`为`GF-1_PMS`.
![](https://assignmanage.oss-cn-nanjing.aliyuncs.com/5c1dc7af5fb7c68b68bd37fc9b5e5be.jpg)

##### CUR_PRODUCT_NAME

==CUR_PRODUCT_NAME== 同样地，采用下图中已有的 `product_name` 一列。设定前，请查看下表中是否有已经设定的相关产品名称；

查看方式：根据已经设定的`CUR_SENSOR_NAME`，例如`GF-1_PMS`，其`sensor_id`在上图中查找，发现`sensor_id`为`SE1240b`，在下图中查找`sensor_id`为`SE1240b`的`product_name`，发现有`GF-1_ARD`和`Level_1A`. 假设现在入库GF-1的ARD数据，即可将`CUR_SENSOR_NAME`设为`GF-1_ARD`.

![](https://assignmanage.oss-cn-nanjing.aliyuncs.com/d4eb3ec12b745116ef5881464f0de30.jpg)

##### CUR_RESOLUTION

设定==CUR_RESOLUTION==为实际分辨率，高分一号则为`2m`

##### CUR_PERIOD

设定``CUR_PERIOD``为实际周期天数

##### TAGS

设定==TAGS==：
```json
"TAGS": {
	"source": "national" | "international", # 国内或国外
	"production": "light" | "radar",        # 光学或雷达
	"category": "ard" | "normal"            # ARD或普通
}
```

#### --output_log

输出log.txt的绝对路径，注意==不要与历史log冲突==，除非您确定清除历史log.txt

## 二、输出LOG说明

### log.txt 样例输出

```cmd
========== [Landsat8_OLI] ==========
[Scene 1] E:\Data\0708\LC08_L2SP_121035_20250413_20250416_02_T1\LC08_L2SP_121035_20250413_20250416_02_T1.tiff
[FAILED] Scene 1, E:\Data\0708\LC08_L2SP_121035_20250413_20250416_02_T1\LC08_L2SP_121035_20250413_20250416_02_T1.tiff
[ERROR] insert_to_db() failed
[WARNING] Data may have been partially written, please check manually.
[Scene 2] E:\Data\0708\LC08_L2SP_122034_20250420_20250425_02_T1\LC08_L2SP_122034_20250420_20250425_02_T1.tiff
[FAILED] Scene 2, E:\Data\0708\LC08_L2SP_122034_20250420_20250425_02_T1\LC08_L2SP_122034_20250420_20250425_02_T1.tiff
[ERROR] insert_to_db() failed
[WARNING] Data may have been partially written, please check manually.
[Scene 3] E:\Data\0708\LC08_L2SP_122035_20250420_20250425_02_T1\LC08_L2SP_122035_20250420_20250425_02_T1.tiff
[FAILED] Scene 3, E:\Data\0708\LC08_L2SP_122035_20250420_20250425_02_T1\LC08_L2SP_122035_20250420_20250425_02_T1.tiff
[ERROR] insert_to_db() failed
[WARNING] Data may have been partially written, please check manually.
========== Batch Insert End for this product ==========

========== [Landsat9_OLI] ==========
[Scene 1] E:\Data\0708\LC09_L2SP_122034_20250412_20250413_02_T1\LC09_L2SP_122034_20250412_20250413_02_T1.tiff
[FAILED] Scene 1, E:\Data\0708\LC09_L2SP_122034_20250412_20250413_02_T1\LC09_L2SP_122034_20250412_20250413_02_T1.tiff
[ERROR] insert_to_db() failed
[WARNING] Data may have been partially written, please check manually.
[Scene 2] E:\Data\0708\LC09_L2SP_123034_20250419_20250420_02_T1\LC09_L2SP_123034_20250419_20250420_02_T1.tiff
[SUCCESS] Scene 2, E:\Data\0708\LC09_L2SP_123034_20250419_20250420_02_T1\LC09_L2SP_123034_20250419_20250420_02_T1.tiff
========== Batch Insert End for this product ==========
```

### 输出说明

入库成功：

```cmd
[Scene 2] E:\Data\0708\LC09_L2SP_123034_20250419_20250420_02_T1\LC09_L2SP_123034_20250419_20250420_02_T1.tiff
[SUCCESS] Scene 2, E:\Data\0708\LC09_L2SP_123034_20250419_20250420_02_T1\LC09_L2SP_123034_20250419_20250420_02_T1.tiff
```

入库失败：

```
[FAILED]
或
[NOTSTARTED]
```

## 三、应用场景

仅应用于以下情况：

- XML 确保规范
- 多波段文件组织规范：
	-- 📁景列表所在目录：
		-- 📁GF1_PMS_E116.4_N35.8_20250426_L1A1228686752
			-- GF1_PMS_E116.4_N35.8_20250426_L1A1228686752.tif
			-- GF1_PMS_E116.4_N35.8_20250426_L1A1228686752_cloud.tif (云掩膜波段包含==cloud==字样)
			-- Metadata.xml (同一文件夹不要出现多个XML文件，程序只识别第一个==XML==文件，优先采用带有==Metadata==字样的)
		-- 📁GF1_PMS_E115.4_N35.8_20250426_L1A1228686752
			-- GF1_PMS_E115.4_N35.8_20250426_L1A1228686752.tif
			-- GF1_PMS_E115.4_N35.8_20250426_L1A1228686752_cloud.tif
			-- Metadata.xml
		...
- 单波段文件组织规范：
	-- 📁景列表所在目录：
		-- 📁GF1_PMS_E116.4_N35.8_20250426_L1A1228686752
		    -- 📁Bands
		     -- GF1_PMS_E116.4_N35.8_20250426_L1A1228686752_B1.tif
		     -- GF1_PMS_E116.4_N35.8_20250426_L1A1228686752_B2.tif
		     -- ...
			-- GF1_PMS_E116.4_N35.8_20250426_L1A1228686752_cloud.tif (云掩膜波段包含==cloud==字样)
			-- Metadata.xml (同一文件夹不要出现多个XML文件，程序只识别第一个==XML==文件，优先采用带有==Metadata==字样的)
		-- 📁GF1_PMS_E115.4_N35.8_20250426_L1A1228686752
			-- 📁Bands
			  -- ...
			-- GF1_PMS_E115.4_N35.8_20250426_L1A1228686752_cloud.tif
			-- Metadata.xml
		...
## 四、注意事项

 - 新建 **传感器** 时，注意在`sensor_table`里`data_type` 里设置一个类型，再改一下`band_config.json`; 
 - 谨慎添加新的data_type，现有类型：`satellite`，`dem`，`dsm`，`ndvi`，`svr`，`3d`;