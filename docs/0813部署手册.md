
## ä¸€ã€å‡†å¤‡å·¥ä½œ

- ä¸‹è½½ç™¾åº¦ç½‘ç›˜æ–‡ä»¶è‡³å†…ç½‘
- æœåŠ¡å™¨ä¿¡æ¯
```bash
IP: 172.31.13.20
IP: 172.31.13.21
IP: 172.31.13.22
IP: 172.31.13.23
Pwd: Sasmac@123 æˆ– sasmac@123
```

- ç¡®ä¿æœåŠ¡å™¨`æ—¶é—´`æ­£ç¡®ï¼ˆä¹‹å‰é”™4åˆ†é’Ÿå·¦å³ä¹Ÿå¯ï¼‰
```bash
# æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶é—´å’Œæ—¥æœŸ
date

# æŸ¥çœ‹å½“å‰æ—¶åŒºè®¾ç½®
timedatectl

# å¦‚æœæ—¶åŒºä¸å¯¹
sudo timedatectl set-timezone Asia/Shanghai

# è®¾ç½®ä¸ºå½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆæ ¼å¼ï¼šYYYY-MM-DD HH:MM:SSï¼‰
sudo date -s "2025-08-14 10:30:00"
```

- ç¡®ä¿æœ¬æœºæ¼”ç¤ºçš„windowsçš„æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´è¿‘ä¼¼åŒæ­¥
- æ³¨æ„ç—…æ¯’ğŸ¦ æ•°æ®ï¼ˆæœ‰ç©ºæ ¼å­—ç¬¦ï¼‰


## äºŒã€åœç”µå´©æºƒçš„æœåŠ¡é‡å¯

- åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Š20-23æ‰§è¡Œï¼š
```bash
# éªŒè¯ Docker æ˜¯å¦å¼€æœºè‡ªå¯
sudo systemctl is-enabled docker

# å¦‚æœä¸æ˜¯ï¼Œè®¾ç½®è‡ªåŠ¨å¯åŠ¨
sudo systemctl enable docker  # é»˜è®¤é€šå¸¸å·²å¯ç”¨
```

- æŸ¥äº†ä¸€ä¸‹å¥½åƒæ²¡æœ‰ï¼Œä¸‡äº‹å¤§å‰ğŸ˜
```bash
# æ­¤å¤„çœç•¥1wå­—
```



## ä¸‰ã€InDBå…¥åº“

- ç¡®ä¿å„é¡¹å…¥åº“å·¥ä½œæš‚åœâš ï¸â€¼ï¸
- ä¿®æ”¹æ‰€æœ‰è·Ÿå…¥åº“ç¨‹åºç›¸å…³çš„`dbConfig.json`æ–‡ä»¶ï¼Œä¿®æ”¹`MYSQL_RESOURCE_DB`å¯¹åº”å€¼ä¸º`ard_satellite`
- âš ï¸åŠ¡å¿…ç¡®ä¿ä¿®æ”¹ï¼Œå¦åˆ™æ•°æ®å¯èƒ½ä¼šé”™å…¥åˆ°éç›®æ ‡æ•°æ®åº“ä¸­ï¼



## å››ã€MySQLæ•°æ®åº“

- è¿›å…¥Navicatï¼Œæ‰¾åˆ°`172.31.13.21`èŠ‚ç‚¹ä¸Šçš„mysqlï¼Œåœ¨satelliteæ•°æ®åº“ä¸­å¯¼å‡ºå„ä¸ªæ•°æ®è¡¨ä¸ºsqlæ–‡ä»¶
- æ–°å»ºæ•°æ®åº“`ard_satellite`, `ard_dev`, `ard_iam`ï¼Œå­—ç¬¦é›†é€‰æ‹©`utf8mb4`
- ä½¿ç”¨sqlè½¬æ¢å·¥å…·ï¼ˆåœ¨sql_converteræ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œè½¬æ¢sqlæ–‡ä»¶ï¼Œéœ€è¦æœ‰`pythonç¯å¢ƒ`ï¼ˆå¾…è½¬æ¢æ–‡ä»¶æ”¾åœ¨`sql`æ–‡ä»¶å¤¹ä¸‹ï¼Œè½¬æ¢åæ–‡ä»¶è®¿é—®`fixed`æ–‡ä»¶å¤¹ä¸‹ï¼‰
- åœ¨ard_satelliteæ•°æ®åº“ä¸­ä¾æ¬¡æ‰§è¡Œcase_table/region_table/sensor_table/product_table/scene_table/image_tableå¯¹åº”çš„è½¬æ¢åçš„sqlæ–‡ä»¶
- åœ¨ard_devæ•°æ®åº“ä¸­ä¾æ¬¡æ‰§è¡Œproject/project_dataå¯¹åº”çš„sqlæ–‡ä»¶
- åœ¨ard_iamæ•°æ®åº“ä¸­æ‰§è¡Œuserå¯¹åº”çš„sqlæ–‡ä»¶
### æ”¹åŠ¨
#### ard_satellite

- case_tableæ–°å¢å­—æ®µ`user_id`ï¼Œç±»å‹`varchar`ï¼Œé•¿åº¦`255`ï¼Œä¸æ˜¯nullå‹¾é€‰
- case_table `create_time`è®°å¾—ä¸è¦âš ï¸`éšå½“å‰æ—¶é—´æˆ³æ›´æ–°`ï¼ˆå¸¦æ¥ç›¸åº”æ•°æ®åº“æ—¶åŒºé—®é¢˜ï¼‰
#### ard_dev

- projectè¡¨åå˜æ›´ä¸º`project_table`
- project_dataè¡¨åå˜æ›´ä¸º`project_data_table`
- ä¾æ¬¡æ‰§è¡Œ`category_table`å’Œ`tool_table`çš„sqlæ–‡ä»¶ï¼ˆä½äºç™¾åº¦ç½‘ç›˜mysqlæ–‡ä»¶å¤¹ä¸‹ï¼‰
#### ard_iam

- userè¡¨åå˜æ›´ä¸º`user_table`
- user_tableæ–°å¢å­—æ®µ`avatar_path`ï¼Œç±»å‹varcharï¼Œé•¿åº¦255
- user_tableå°†`user_id`è®¾ç½®ä¸ºä¸»é”®
- å¯¼å…¥ç©ºè¡¨`record_table`ç»“æ„ï¼ˆä½äºç™¾åº¦ç½‘ç›˜mysqlæ–‡ä»¶å¤¹ä¸‹ï¼‰



## äº”ã€PostgreSQLæ•°æ®åº“

### 1.sqlæ–‡ä»¶æ‹·è´

åœ¨`172.31.13.21`èŠ‚ç‚¹ä¸Šï¼Œå°†`satellite_backup.sql`æ–‡ä»¶ï¼ˆä½äºpgsqlæ–‡ä»¶å¤¹ä¸‹ï¼‰æ‹·è´åˆ°`/mnt/volumes/postgresql/data/sql`æ–‡ä»¶å¤¹ä¸‹(å¦‚æœæ²¡æœ‰sqlæ–‡ä»¶å¤¹ï¼Œå°±æ–°å»ºä¸€ä¸ª)  
### 2ã€åˆ é™¤æˆ–å¤‡ä»½æ—§æ•°æ®åº“(åœ¨navicatä¸­æ‰§è¡Œ)

#### æ–¹æ³•1 åˆ é™¤æ—§æ•°æ®åº“
ä¹Ÿå¯ä»¥å…ˆæ‰§è¡Œç¬¬ä¸‰æ­¥ï¼ŒæŠŠç¬¬ä¸‰æ­¥å‘½ä»¤è¡Œä¸­çš„ -d satellite æ”¹ä¸º -d satellite_backupï¼Œç„¶åå†æ‰§è¡Œç¬¬2æ­¥ï¼Œæ‰§è¡Œä¹‹åæŠŠsatellite_backupæ”¹åä¸ºsatelliteï¼Œé¿å…å¯¼å…¥å‡ºé—®é¢˜ï¼Œæ— æ³•æ¢å¤æ•°æ®åº“ã€‚

1.æ‰‹åŠ¨åˆ é™¤æ‰€æœ‰è¡¨

2.æ¸…ç†åºåˆ—åºåˆ—ï¼Œæ‰§è¡Œå¦‚ä¸‹sqlè¯­å¥ï¼Œç›´æ¥å¤åˆ¶è¿”å›çš„å‘½ä»¤å¹¶æ‰§è¡Œï¼Œæ¥åˆ é™¤åˆ›å»ºçš„åºåˆ—ï¼Œä»¥æ¸…ç†å¹²å‡€æ¨¡å¼ï¼Œå¹¶åˆ é™¤æ¨¡å¼ã€‚

```sql
SELECT 'DROP SEQUENCE IF EXISTS ' || sequence_schema || '.' || sequence_name || ' CASCADE;'
FROM information_schema.sequences
WHERE sequence_schema NOT IN ('pg_catalog', 'information_schema');
```

#### æ–¹æ³•2 é‡å‘½åæ—§æ•°æ®åº“

- åœ¨Navicatä¸­é‡å‘½åæ—§æ•°æ®åº“
- å¦‚æœå‡ºç°å…¶ä»–ç”¨æˆ·sessionæœªæ–­å¼€ï¼Œè¿›å…¥å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤ï¼š
```bash
docker ps
docker exec <container-name> -it /bin/bash 
```

```sql
psql -U postgres -c "SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = 'satellite';"
```
### 3ã€æ¢å¤

- è¿›å…¥postgreSQLå®¹å™¨å†…éƒ¨å‘½ä»¤è¡Œç•Œé¢ï¼Œæ‰§è¡Œå‘½ä»¤
```bash
docker ps
docker exec <container-name> -it /bin/bash 
```

```bash
psql -U postgres -h 172.31.13.21 -p 5432 -d satellite -f /var/lib/postgresql/data/sql/satellite_backup.sql
```

- éªŒè¯æ–°æ•°æ®åº“æ— è¯¯åï¼Œåˆ é™¤sqlæ–‡ä»¶å¤¹ï¼ˆå¯é€‰ï¼‰
```bash
sudo rm -rf /var/lib/postgresql/data/sql/
```



## å…­ã€é•œåƒæ›´æ–°

- è¿›å…¥`172.31.13.23`èŠ‚ç‚¹çš„`/mnt/images`ç›®å½•ä¸‹ï¼Œå¤‡ä»½åŸæœ‰é•œåƒæ–‡ä»¶ï¼Œ
- å¤‡ä»½åä¸Šä¼ æ–°çš„é•œåƒæ–‡ä»¶taråŒ…`model-server-arm.tar`ï¼ˆä½äºimagesæ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼Œå¦‚æœæœ‰é‡åå°±é‡å‘½å
- æ£€æŸ¥è¿è¡Œä¸­çš„å®¹å™¨ï¼Œè®°å½•å®¹å™¨çš„åç§°å¦‚model-serverã€ray-worker_1ï¼š
```bash
docker ps
```

- ä¾æ¬¡æ‰§è¡Œï¼ˆå…ˆåœæ­¢ååˆ é™¤å®¹å™¨ï¼‰ï¼š
```bash
docker stop model-server
docker stop ray-worker_1
docker rm model-server
docker rm ray-worker_1
```

- å¦‚æœç¡®å®šè¯¥æœåŠ¡å™¨åªæœ‰è¿™ä¸¤ä¸ªå®¹å™¨ï¼Œé‚£å°±ç›´æ¥ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å†…å®¹ï¼š
```bash
docker stop $(docker ps -q)
docker rm $(docker ps -q)
```

- æ£€æŸ¥ç°æœ‰é•œåƒåˆ—è¡¨åŠåç§°ï¼š
```bash
docker images
```

- åˆ é™¤æ—§çš„é•œåƒï¼ˆå‡è®¾æ ‡ç­¾æ˜¯0624ï¼‰
```bash
docker rmi model-server:0624
```

- å¯¼å…¥æ–°é•œåƒ
```bash
docker load -i /mnt/images/model-server-arm.tar
```

- æ£€æŸ¥é•œåƒåˆ—è¡¨
```bash
docker images
```

- ä»¥ä¸ŠåŒæ ·çš„æ­¥éª¤ï¼Œåœ¨`172.31.13.20`èŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸€éï¼Œå¯èƒ½çš„å®¹å™¨åç§°æ˜¯ï¼šray-worker_2å’Œray-worker_3



## ä¸ƒã€å‰ç«¯æ›´æ–°

- æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸ºäº†æµ‹è¯•åˆ†ä¸ºç“¦ç‰‡çº¢çº¿æµ‹è¯•ç‰ˆ`dist_test.zip`å’Œç”Ÿäº§ç‰ˆæœ¬`dist_prod.zip`
- è¿›å…¥`172.31.13.21`èŠ‚ç‚¹çš„`/mnt/volumes/front/html`æ–‡ä»¶å¤¹ï¼Œå¤‡ä»½æ‰€æœ‰æ–‡ä»¶
- å¤‡ä»½ååˆ é™¤é™¤äº†`app.conf.json`çš„å…¶ä»–æ–‡ä»¶ï¼Œå†æŠŠfrontæ–‡ä»¶å¤¹ä¸‹`dist_test.zip`ä¸­è§£å‹çš„å†…å®¹æ‹·è´è‡³å…¶ä¸­ï¼Œè§‚å¯Ÿæ–‡ä»¶æ•°æ˜¯å¦æ­£ç¡®ï¼Œæå°‘æ•°æƒ…å†µä¼šå°‘æ‹·è´ï¼ˆæ³¨æ„`style`ï¼‰
- æ£€æŸ¥`/mnt/volumes/front/html/app.conf.json`å’Œ`/mnt/volumes/front/conf/nginx.conf`æ–‡ä»¶ï¼Œå°¤å…¶`websocket`å’Œ`back_app3`é…ç½®ï¼ˆä¹‹å‰ä¸€æ³¢åº”è¯¥å·²ç»æ”¹è¿‡ï¼‰
- è¿è¡Œå‘½ä»¤ï¼š
```bash
docker restart front
```

- å¯è§†åŒ–åŠŸèƒ½æ²¡é—®é¢˜åï¼Œå¯æ›¿æ¢ä¸º`dist_prod.zip`ä¸­çš„å†…å®¹è¿›è¡Œéƒ¨ç½²


## å…«ã€åç«¯æ›´æ–°

- å»æ‰tileæ•°æ®æºï¼Œå»ºè®®å»æ‰SET SESSION group_concat_max_len = 18446744073709551615ï¼ˆå‡ºé—®é¢˜çš„è¯å°±å»æ‰ï¼‰ï¼›useSSL
- è¿›å…¥`172.31.13.21`èŠ‚ç‚¹çš„`/mnt/volumes/back`æ–‡ä»¶å¤¹ï¼Œå¤‡ä»½æ‰€æœ‰æ–‡ä»¶
- å¤‡ä»½ååˆ é™¤satellite.jarï¼Œå†æŠŠæ–°çš„`satellite.jar`æ‹·è´è¿›å»ï¼ˆåœ¨backæ–‡ä»¶å¤¹ä¸‹ï¼Œæ³¨æ„`vmod`é…ç½®æ˜¯å¦ä¸å…¶ä»–ä¸€è‡´âš ï¸âš ï¸ï¼‰
- åŒæ ·çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œç¡®è®¤`band_config.json`æ˜¯å¦éœ€è¦å˜åŠ¨
	- å¦‚æœæ·»åŠ äº†æ–°çš„ä¼ æ„Ÿå™¨é…ç½®ï¼Œè¯·ç¡®ä¿ä»¥ä¸‹å‡ ä¸ªä½ç½®åŒæ—¶æ›´æ–°ï¼š
	- `sensor_table`è¡¨æ–°ä¼ æ„Ÿå™¨`data_type`åŒæ­¥ä»¥åŠdesc
	- è°¨æ…æ·»åŠ æ–°çš„data_typeï¼Œåç«¯è¦æ”¹
- åŒæ ·çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œè¿›å…¥`/modelDockerVolume/devCli`æ–‡ä»¶å¤¹
	- ä¿®æ”¹`config.json`æ–‡ä»¶
		- ä¿®æ”¹databaseğŸ‘‰`satellite_database`å¯¹åº”å€¼ä¸º`ard_satellite`, æ·»åŠ é€—å·
		- æ·»åŠ é”®å€¼å¯¹databaseğŸ‘‰`dev_database` : `ard_dev`
	- ä¿®æ”¹watcher.pyæ–‡ä»¶
		- æ›¿æ¢ä¸ºæ–°çš„watcher.pyæ–‡ä»¶(backæ–‡ä»¶å¤¹ä¸‹)
- è¿è¡Œå‘½ä»¤ï¼š
```bash
docker restart back
```



## ä¹ã€MinIO æ›´æ–°

- æµè§ˆå™¨æ‰“å¼€ç½‘å€`http://172.31.13.21:9001`
- æ·»åŠ æ–°æ¡¶`user`
- ç¡®ä¿æ–°æ¡¶çš„éšç§ç­–ç•¥ä¸º`public`



## åã€Titiler æ›´æ–°

- è®°å¾—æ›´æ–°`config.json`æ–‡ä»¶ä¸º`vmod`
- è¿›å…¥`172.31.13.22`èŠ‚ç‚¹çš„`/mnt/volumes/titiler`æ–‡ä»¶å¤¹ï¼Œå¤‡ä»½å…¨éƒ¨ä»£ç æ–‡ä»¶
- å¤‡ä»½ååœ¨æ¯ä¸ªå­æ–‡ä»¶å¤¹ä¸‹ä¾æ¬¡åˆ é™¤ï¼Œé™¤äº†`_pycache__`çš„æ–‡ä»¶å¤¹
- æ‹·è´æ–°çš„æ–‡ä»¶ï¼ˆé™¤äº†__pycache__æ–‡ä»¶å¤¹ï¼‰åˆ°ç›¸åº”ç›®å½•ï¼ˆåœ¨version2æ–‡ä»¶å¤¹ä¸‹ï¼‰
- è¿è¡Œå‘½ä»¤ï¼š
```bash
docker restart $(docker ps -q)
```



## åä¸€ã€ModelServer æ›´æ–°

- å¤§èŒƒå›´æŠ¥é”™è€ƒè™‘çš„å‡ ä¸ªé—®é¢˜ï¼šrayä¸Šä¸‹æ–‡å‚æ•°ä½“é‡åºå¤§ï¼Œæœ‰å†å²å¤ç”¨æœºåˆ¶ï¼ŒJSONä¸€åŠä¼ ä¸äº†äº†ï¼Œå†…å­˜æ˜¯é’ˆå¯¹æ ¼ç½‘è€Œè¨€çš„ï¼Œåº”è¯¥ä¸ä¼šçˆ†ç‚¸ï¼Œå¦‚æœğŸ’¥ï¼Œè€ƒè™‘æ¯ä¸ªä»»åŠ¡è®¾ç½®å†…å­˜cpuä¸Šé™ï¼›grid_mosaicå†…å­˜æ˜¾å¼é‡Šæ”¾
- å¤§èŒƒå›´çš„å‡ ä¸ªç“¶é¢ˆMinioã€åç«¯ã€rayè®¡ç®—
- å¤æ‚æ— äº‘ä¸€ç‰ˆå›¾å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ°NIRæŠ¥é”™
- æ³¨æ„`config`ä¿®æ”¹ï¼Œæ¶‰åŠ`ard_satellite`çš„ï¼Œæ¶‰åŠæ—¥å¿—çš„åŠ ä¸Š`flush=True`
- è¿›å…¥`172.31.13.23`èŠ‚ç‚¹ä¸­çš„`/mnt/volumes/modelServer`æ–‡ä»¶å¤¹ï¼Œå¤‡ä»½å…¨éƒ¨ä»£ç æ–‡ä»¶
- å¤‡ä»½ååœ¨æ¯ä¸ªå­æ–‡ä»¶å¤¹ä¾æ¬¡åˆ é™¤ï¼Œé™¤äº†`_pycache__`å’Œ`history`æ–‡ä»¶å¤¹
- æ‹·è´æ–°çš„æ–‡ä»¶ï¼ˆé™¤äº†__pycache__æ–‡ä»¶å¤¹å’Œhistoryæ–‡ä»¶å¤¹ï¼‰åˆ°ç›¸åº”ç›®å½•ï¼ˆåœ¨modelServeræ–‡ä»¶å¤¹ä¸‹ï¼‰
- ä¾æ¬¡è¿è¡Œå‘½ä»¤ï¼š
```bash
# å¯åŠ¨model-server
docker run -d --name model-server -p 5000:5000 -p 6379:6379 -p 8265:8265 -v /mnt/volumes/modelServer:/usr/resource --network=host -w /usr/resource --restart=always --privileged=true --shm-size=13gb model-server:0812 bash -c "ray start --include-dashboard=True --head --node-ip-address=0.0.0.0 --port=6379 --dashboard-host=0.0.0.0 --num-cpus=36 --memory=36000000000 --object-store-memory=12000000000 && python -m dataProcessing.server"

# æ£€æŸ¥æ˜¯å¦æ­£å¸¸
docker logs model-server

# å¯åŠ¨å·¥ä½œèŠ‚ç‚¹1
docker run -d --name ray-worker_1 --shm-size=5.5gb --network=host -v /mnt/volumes/modelServer:/usr/resource model-server:0812 bash -c "ray start --address='172.31.13.23:6379' --block"
```

- è¿›å…¥`172.31.13.20`èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ï¼š
```bash
# å¯åŠ¨å·¥ä½œèŠ‚ç‚¹2
docker run -d --name ray-worker_2 --shm-size=5.5gb --network=host -v /mnt/volumes/modelServer:/usr/resource model-server:0812 bash -c "ray start --address='172.31.13.23:6379' --block"

# å¯åŠ¨å·¥ä½œèŠ‚ç‚¹3
docker run -d --name ray-worker_3 --shm-size=5.5gb --network=host -v /mnt/volumes/modelServer:/usr/resource model-server:0812 bash -c "ray start --address='172.31.13.23:6379' --block"
```

- æ‰“å¼€ç½‘å€æŸ¥çœ‹æ˜¯å¦æ­£å¸¸ï¼š`http://172.31.13.23:8265`

## Base Map service

ç›®å½•ç»“æ„æ¢æŸ¥